<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVNC.AI - Da Vinci Innovation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8B7500;
            --primary-dark: #6B5A00;
            --secondary: #B8960F;
            --tertiary: #DAA520;
            --quaternary: #F4E4BC;
            --background: #FFFFFF;
            --surface: #FFFEF9;
            --border: #F0EDE5;
            --accent: #8B7500;
            --accent-light: rgba(139, 117, 0, 0.1);
            --accent-lighter: rgba(139, 117, 0, 0.05);
            --success: #6B8E23;
            --warning: #B8860B;
            --error: #CD5C5C;
            --mechanics: #8B7500;
            --anatomy: #B8860B;
            --optics: #DAA520;
            --shadow-xs: 0 1px 2px rgba(139, 117, 0, 0.04);
            --shadow-sm: 0 2px 4px rgba(139, 117, 0, 0.06);
            --shadow-md: 0 4px 8px rgba(139, 117, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(139, 117, 0, 0.1);
            --shadow-xl: 0 16px 32px rgba(139, 117, 0, 0.12);
            --transition: cubic-bezier(0.4, 0, 0.2, 1);
            --text-primary: #2C2C2C;
            --text-secondary: #5A5A5A;
            --text-tertiary: #8A8A8A;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px;
            line-height: 1.5;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .logo-mark {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo-text {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            margin-top: 56px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .sidebar-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .prompt-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .prompt-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s var(--transition);
            font-size: 13px;
            color: var(--secondary);
            position: relative;
            overflow: hidden;
        }

        .prompt-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-lighter);
            opacity: 0;
            transition: opacity 0.2s var(--transition);
        }

        .prompt-item:hover::before {
            opacity: 1;
        }

        .prompt-item.selected {
            background: var(--accent-light);
            color: var(--accent);
            font-weight: 500;
        }

        .generate-section {
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .generate-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .generate-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn-icon {
            transition: transform 0.2s var(--transition);
        }

        .generate-btn:hover:not(:disabled) .generate-btn-icon {
            transform: translateX(2px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 56px;
            background: var(--background);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* Welcome State */
        .welcome-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 112px);
            text-align: center;
            animation: fadeIn 0.6s var(--transition);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-icon {
            width: 64px;
            height: 64px;
            background: var(--surface);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .welcome-subtitle {
            font-size: 14px;
            color: var(--tertiary);
            max-width: 480px;
            line-height: 1.6;
        }

        /* Message Thread */
        .message-thread {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
            animation: slideIn 0.5s var(--transition);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-user {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 32px;
        }

        .message-user-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 16px;
            border-radius: 16px 16px 4px 16px;
            max-width: 60%;
            font-size: 14px;
        }

        .message-ai {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .ai-section {
            opacity: 0;
            animation: fadeInSection 0.6s var(--transition) forwards;
        }

        @keyframes fadeInSection {
            to {
                opacity: 1;
            }
        }

        /* Process Steps */
        .process-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            position: relative;
        }

        .step-indicator {
            width: 32px;
            height: 32px;
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            transition: all 0.3s var(--transition);
        }

        .step-indicator.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
            animation: pulseRing 1.5s var(--transition);
        }

        @keyframes pulseRing {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 102, 255, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(0, 102, 255, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 102, 255, 0);
            }
        }

        .step-indicator.mechanics.complete {
            background: var(--mechanics);
            border-color: var(--mechanics);
            color: white;
        }

        .step-indicator.anatomy.complete {
            background: var(--anatomy);
            border-color: var(--anatomy);
            color: white;
        }

        .step-indicator.optics.complete {
            background: var(--optics);
            border-color: var(--optics);
            color: white;
        }

        .step-content {
            flex: 1;
            padding-bottom: 24px;
        }

        .step-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 12px;
            background: var(--accent-lighter);
            color: var(--accent);
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .step-status.complete {
            background: var(--success);
            color: white;
            animation: none;
        }

        .step-outputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .output-item {
            padding: 16px;
            background: var(--background);
            border-radius: 8px;
            border-left: 3px solid var(--border);
            transition: all 0.2s var(--transition);
            opacity: 0;
            animation: slideInOutput 0.5s var(--transition) forwards;
        }

        @keyframes slideInOutput {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .output-item.mechanics {
            border-left-color: var(--mechanics);
        }

        .output-item.anatomy {
            border-left-color: var(--anatomy);
        }

        .output-item.optics {
            border-left-color: var(--optics);
        }

        .output-description {
            font-size: 14px;
            color: var(--primary);
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .output-inspiration {
            font-size: 13px;
            color: var(--tertiary);
            font-style: italic;
            padding-left: 12px;
            border-left: 2px solid var(--border);
        }

        .output-source {
            font-size: 12px;
            color: var(--quaternary);
            margin-top: 4px;
        }

        /* Synthesis Visualization */
        .synthesis-container {
            padding: 32px;
            margin: 32px 0;
            background: linear-gradient(135deg, var(--accent-lighter), transparent);
            border-radius: 16px;
            position: relative;
            opacity: 0;
            animation: fadeInScale 0.8s var(--transition) forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .synthesis-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .synthesis-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .synthesis-subtitle {
            font-size: 13px;
            color: var(--tertiary);
        }

        .synthesis-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 48px;
            margin: 48px 0;
            position: relative;
        }

        .knowledge-node {
            width: 80px;
            height: 80px;
            background: var(--background);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 2;
            opacity: 0;
            animation: nodeAppear 0.6s var(--transition) forwards;
        }

        @keyframes nodeAppear {
            from {
                opacity: 0;
                transform: scale(0);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .knowledge-node.mechanics {
            animation-delay: 0s;
            border: 2px solid var(--mechanics);
        }

        .knowledge-node.anatomy {
            animation-delay: 0.2s;
            border: 2px solid var(--anatomy);
        }

        .knowledge-node.optics {
            animation-delay: 0.4s;
            border: 2px solid var(--optics);
        }

        .node-icon {
            font-size: 24px;
        }

        .node-label {
            font-size: 11px;
            color: var(--tertiary);
            font-weight: 500;
        }

        .synthesis-center {
            position: absolute;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--mechanics), var(--anatomy), var(--optics));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            opacity: 0;
            animation: centerExpand 1s var(--transition) 0.8s forwards;
            box-shadow: var(--shadow-xl);
        }

        @keyframes centerExpand {
            from {
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(360deg);
            }
        }

        .connection-lines {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 2px;
            transform: translate(-50%, -50%);
        }

        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--tertiary), transparent);
            opacity: 0;
            animation: lineGrow 0.8s var(--transition) 0.6s forwards;
        }

        @keyframes lineGrow {
            from {
                width: 0;
                opacity: 0;
            }
            to {
                width: 150px;
                opacity: 0.3;
            }
        }

        /* Features Grid */
        .features-section {
            margin-top: 32px;
        }

        .features-header {
            font-size: 14px;
            font-weight: 600;
            color: var(--tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .feature-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s var(--transition);
            opacity: 0;
            animation: slideInFeature 0.5s var(--transition) forwards;
        }

        @keyframes slideInFeature {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feature-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .feature-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--surface);
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
            color: var(--tertiary);
            margin-bottom: 12px;
        }

        .feature-description {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .feature-inspiration {
            font-size: 13px;
            color: var(--tertiary);
            font-style: italic;
            padding: 12px;
            background: var(--surface);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .feature-metadata {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .development-stage {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stage-concept {
            background: var(--accent-lighter);
            color: var(--accent);
        }

        .stage-prototype {
            background: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }

        .stage-production-ready {
            background: rgba(0, 200, 150, 0.1);
            color: var(--success);
        }

        .engineering-notes {
            font-size: 12px;
            color: var(--quaternary);
            line-height: 1.4;
        }

        /* Final Product */
        .product-section {
            margin-top: 48px;
            padding: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 16px;
            opacity: 0;
            animation: fadeInProduct 0.8s var(--transition) forwards;
            box-shadow: var(--shadow-xl);
        }

        @keyframes fadeInProduct {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-header {
            margin-bottom: 32px;
        }

        .product-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .product-market {
            font-size: 14px;
            opacity: 0.8;
        }

        .scores-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin: 32px 0;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.6;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .score-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: white;
            border-radius: 2px;
            transition: width 1.5s var(--transition);
        }

        .product-description {
            padding: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            line-height: 1.8;
            font-size: 14px;
        }

        .principles-list {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .principle-tag {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Loading State */
        .loading-pulse {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 1.4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .loading-pulse:nth-child(2) {
            animation-delay: 0.2s;
            margin-left: 4px;
        }

        .loading-pulse:nth-child(3) {
            animation-delay: 0.4s;
            margin-left: 4px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--quaternary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .synthesis-visual {
                flex-direction: column;
                gap: 24px;
            }
            
            .connection-lines {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-mark">DV</div>
                <div class="logo-text">DVNC.AI</div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Design Prompts</div>
                <div class="sidebar-subtitle">Select a prompt to begin synthesis</div>
            </div>
            
            <div class="prompt-list" id="promptList"></div>

            <div class="generate-section">
                <button class="generate-btn" id="generateBtn" disabled>
                    <span>Generate Design</span>
                    <span class="generate-btn-icon">‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="chat-container" id="chatContainer">
                <div class="welcome-state" id="welcomeState">
                    <div class="welcome-icon">‚óà</div>
                    <div class="welcome-title">Welcome to DVNC.AI</div>
                    <div class="welcome-subtitle">
                        Select a design prompt to begin the polymathic synthesis process. 
                        I'll channel da Vinci's knowledge verticals to generate innovative, market-ready product designs.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/generate';
        
        const prompts = [
            "a next-generation ergonomic computer mouse",
            "an innovative kitchen kettle for urban living",
            "a modular laptop docking station",
            "a patient monitoring device for hospitals",
            "a precision gardening tool system",
            "a sustainable packaging solution for electronics",
            "a smart home lighting system",
            "an eco-friendly water bottle",
            "a wearable fitness tracker",
            "a compact urban bicycle"
        ];

        let selectedPrompt = '';
        let isGenerating = false;

        function initializeUI() {
            const promptList = document.getElementById('promptList');
            
            prompts.forEach((prompt, index) => {
                const promptItem = document.createElement('div');
                promptItem.className = 'prompt-item';
                promptItem.dataset.prompt = prompt;
                promptItem.textContent = prompt;
                promptItem.onclick = () => selectPrompt(prompt, promptItem);
                promptList.appendChild(promptItem);
            });
        }

        function selectPrompt(prompt, element) {
            if (isGenerating) return;
            
            document.querySelectorAll('.prompt-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedPrompt = prompt;
            document.getElementById('generateBtn').disabled = false;
        }

        function createMessageThread(userPrompt) {
            return `
                <div class="message-thread">
                    <div class="message-user">
                        <div class="message-user-content">
                            Design ${userPrompt}
                        </div>
                    </div>
                    <div class="message-ai" id="aiMessage">
                        <!-- AI response will be populated here -->
                    </div>
                </div>
            `;
        }

        function formatSLMOutputs(type, icon, outputs) {
            let outputsHtml = outputs.map((output, idx) => {
                let description = output;
                let inspiration = '';
                let source = '';
                
                if (output.includes('||')) {
                    const parts = output.split('||').map(p => p.trim());
                    description = parts[0];
                    if (parts[1]) inspiration = parts[1];
                    if (parts[2]) source = parts[2].replace('Source:', '').trim();
                }
                
                return `
                    <div class="output-item ${type}" style="animation-delay: ${idx * 0.1}s">
                        <div class="output-description">‚Ä¢ ${description}</div>
                        ${inspiration ? `
                            <div class="output-inspiration">
                                "${inspiration}"
                                ${source ? `<div class="output-source">‚Äî ${source}</div>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            return outputsHtml;
        }

        function formatFeatures(features) {
            return features.map((feature, idx) => `
                <div class="feature-card" style="animation-delay: ${idx * 0.1}s">
                    <div class="feature-number">${idx + 1}</div>
                    <div class="feature-description">${feature.description}</div>
                    <div class="feature-inspiration">
                        "${feature.inspiration}"
                    </div>
                    <div class="feature-metadata">
                        <div class="development-stage stage-${feature.stage.toLowerCase().replace('_', '-')}">
                            ${feature.stage.replace('_', ' ')}
                        </div>
                        <div class="engineering-notes">${feature.notes}</div>
                    </div>
                </div>
            `).join('');
        }

        function formatProduct(data) {
            return `
                <div class="product-section">
                    <div class="product-header">
                        <div class="product-name">${data.name}</div>
                        <div class="product-market">Target Market: ${data.target_market}</div>
                    </div>
                    
                    <div class="scores-container">
                        <div class="score-item">
                            <div class="score-label">Innovation</div>
                            <div class="score-value">${data.innovation_score}</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.innovation_score * 10}%"></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Feasibility</div>
                            <div class="score-value">${data.feasibility_score}</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.feasibility_score * 10}%"></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Viability</div>
                            <div class="score-value">${(data.viability_score * 100).toFixed(0)}%</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.viability_score * 100}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="product-description">
                        The ${data.name} revolutionizes the ${data.product_type} category for ${data.target_market} users.
                        Drawing from da Vinci's genius, it seamlessly blends mechanical precision, biological inspiration, and aesthetic elegance.
                        
                        ${data.features.map(feat => `
                            It incorporates ${feat.description.toLowerCase()}, inspired by "${feat.inspiration}", 
                            currently at ${feat.stage.toLowerCase().replace('_', ' ')} stage (${feat.notes.toLowerCase()}).
                        `).join(' ')}
                        
                        This design not only scores ${data.innovation_score}/10 in innovation but also ${data.feasibility_score}/10 
                        in feasibility, yielding a strong market viability of ${(data.viability_score * 100).toFixed(0)}%. 
                        
                        Imagine a product that feels like an extension of nature itself‚Äîdurable, intuitive, and beautifully 
                        crafted for everyday use, embodying the Renaissance ideal of perfect harmony between form and function.
                    </div>
                    
                    <div class="principles-list">
                        <div class="principle-tag">Mechanics & Physics</div>
                        <div class="principle-tag">Anatomy & Biology</div>
                        <div class="principle-tag">Optics & Aesthetics</div>
                    </div>
                </div>
            `;
        }

        async function generateDesign() {
            if (!selectedPrompt || isGenerating) return;
            
            isGenerating = true;
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            
            const chatContainer = document.getElementById('chatContainer');
            const welcomeState = document.getElementById('welcomeState');
            if (welcomeState) welcomeState.remove();
            
            chatContainer.innerHTML = createMessageThread(selectedPrompt);
            const aiMessage = document.getElementById('aiMessage');
            
            // Create the unified AI response structure
            let responseHTML = `
                <div class="ai-section" style="animation-delay: 0s">
                    <div class="step-title">
                        Initializing Da Vinci Knowledge Synthesis
                        <span class="step-status" id="initStatus">Processing</span>
                    </div>
                </div>
                
                <div class="process-step" id="mechanicsStep">
                    <div class="step-indicator mechanics" id="mechanicsIndicator">‚öô</div>
                    <div class="step-content">
                        <div class="step-title">
                            Mechanics & Physics SLM
                            <span class="step-status" id="mechanicsStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="mechanicsOutputs"></div>
                    </div>
                </div>
                
                <div class="process-step" id="anatomyStep">
                    <div class="step-indicator anatomy" id="anatomyIndicator">ü¶ã</div>
                    <div class="step-content">
                        <div class="step-title">
                            Anatomy & Biology SLM
                            <span class="step-status" id="anatomyStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="anatomyOutputs"></div>
                    </div>
                </div>
                
                <div class="process-step" id="opticsStep">
                    <div class="step-indicator optics" id="opticsIndicator">üëÅ</div>
                    <div class="step-content">
                        <div class="step-title">
                            Optics & Aesthetics SLM
                            <span class="step-status" id="opticsStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="opticsOutputs"></div>
                    </div>
                </div>
                
                <div id="synthesisSection"></div>
                <div id="featuresSection"></div>
                <div id="productSection"></div>
            `;
            
            aiMessage.innerHTML = responseHTML;
            
            try {
                // Simulate initialization
                await new Promise(resolve => setTimeout(resolve, 1000));
                document.getElementById('initStatus').textContent = 'Complete';
                document.getElementById('initStatus').classList.add('complete');
                
                // Make API call or use mock data
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: selectedPrompt })
                }).catch(() => null);
                
                const data = response && response.ok ? await response.json() : getMockData();
                
                // Process each SLM sequentially
                await processSLM('mechanics', '‚öô', data.slm_outputs.mechanics);
                await processSLM('anatomy', 'ü¶ã', data.slm_outputs.anatomy);
                await processSLM('optics', 'üëÅ', data.slm_outputs.optics);
                
                // Synthesis animation with transformation
                await new Promise(resolve => setTimeout(resolve, 500));
                document.getElementById('synthesisSection').innerHTML = `
                    <div class="synthesis-container" id="synthesisContainer">
                        <div class="synthesis-particles" id="particlesContainer"></div>
                        <div class="synthesis-header">
                            <div class="synthesis-title">Da Vinci Abstraction Organ</div>
                            <div class="synthesis-subtitle">Synthesizing knowledge domains...</div>
                        </div>
                        <div class="synthesis-visual">
                            <div class="knowledge-node mechanics">
                                <div class="node-icon">‚öô</div>
                                <div class="node-label">Mechanics</div>
                            </div>
                            <div class="knowledge-node anatomy">
                                <div class="node-icon">ü¶ã</div>
                                <div class="node-label">Anatomy</div>
                            </div>
                            <div class="knowledge-node optics">
                                <div class="node-icon">üëÅ</div>
                                <div class="node-label">Optics</div>
                            </div>
                            <div class="connection-lines">
                                <div class="connection-line"></div>
                            </div>
                            <div class="synthesis-center">‚óà</div>
                        </div>
                        <div class="energy-burst" id="energyBurst"></div>
                    </div>
                `;
                
                // Wait for synthesis animation to complete
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Features section (initially hidden)
                document.getElementById('featuresSection').innerHTML = `
                    <div class="features-section" id="featuresDiv">
                        <div class="features-header">Synthesized Design Features</div>
                        <div class="features-grid">
                            ${formatFeatures(data.features)}
                        </div>
                    </div>
                `;
                
                // Trigger the transformation animation
                const synthesisContainer = document.getElementById('synthesisContainer');
                const featuresDiv = document.getElementById('featuresDiv');
                const energyBurst = document.getElementById('energyBurst');
                const particlesContainer = document.getElementById('particlesContainer');
                
                // Create particles
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${50 + (Math.random() - 0.5) * 30}%`;
                    particle.style.top = `${50 + (Math.random() - 0.5) * 30}%`;
                    particle.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
                    particle.style.setProperty('--ty', `${(Math.random() - 0.5) * 200}px`);
                    particle.style.animationDelay = `${Math.random() * 0.5}s`;
                    particlesContainer.appendChild(particle);
                }
                
                // Wait a moment before transformation
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Start the transformation
                synthesisContainer.classList.add('transforming');
                
                // Animate particles
                document.querySelectorAll('.particle').forEach(p => p.classList.add('animating'));
                
                // Show energy burst
                await new Promise(resolve => setTimeout(resolve, 700));
                energyBurst.classList.add('active');
                
                // Wait for synthesis to vanish
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Emerge features from the synthesis point
                featuresDiv.classList.add('emerging');
                
                // Wait for features to fully appear
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Final product
                document.getElementById('productSection').innerHTML = formatProduct(data);
                
            } catch (error) {
                console.error('Error:', error);
            } finally {
                isGenerating = false;
                generateBtn.disabled = false;
            }
        }

        async function processSLM(type, icon, outputs) {
            const indicator = document.getElementById(`${type}Indicator`);
            const status = document.getElementById(`${type}Status`);
            const outputsContainer = document.getElementById(`${type}Outputs`);
            
            indicator.classList.add('active');
            status.style.display = 'inline-block';
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            outputsContainer.innerHTML = formatSLMOutputs(type, icon, outputs);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            indicator.classList.remove('active');
            indicator.classList.add('complete');
            status.textContent = 'Complete';
            status.classList.add('complete');
        }

        function getMockData() {
            return {
                name: `Vitruvian ${['Harmony', 'Flow', 'Aero', 'Sfumato'][Math.floor(Math.random() * 4)]} ${selectedPrompt.split(' ').slice(-1)[0]}`,
                product_type: selectedPrompt,
                target_market: ['Consumer Electronics', 'Industrial Equipment', 'Medical Devices', 'Sustainable Goods'][Math.floor(Math.random() * 4)],
                innovation_score: Math.floor(Math.random() * 3) + 7,
                feasibility_score: Math.floor(Math.random() * 3) + 7,
                viability_score: (Math.random() * 0.3 + 0.7).toFixed(2),
                features: [
                    {
                        description: "Apply pyramidal law of force to enhance mechanical efficiency and durability",
                        inspiration: "Pyramidal law of force: power diminishes towards its end",
                        stage: "PROTOTYPE",
                        notes: "Prototype feasible with current technology"
                    },
                    {
                        description: "Incorporate proportional harmony based on the Vitruvian system for ergonomic design",
                        inspiration: "Proportional harmony based on the Vitruvian system",
                        stage: "PRODUCTION_READY",
                        notes: "Production-ready using established processes"
                    },
                    {
                        description: "Integrate sfumato technique for visual harmony and perceptual depth",
                        inspiration: "Sfumato: do not make definite boundaries",
                        stage: "CONCEPT",
                        notes: "Conceptual exploration requires validation"
                    }
                ],
                slm_outputs: {
                    mechanics: [
                        "Apply pyramidal law of force to enhance mechanical efficiency || Pyramidal law of force: power diminishes towards its end || Source: Madrid I, 16r",
                        "Use water flow principles for efficient energy distribution || Water seeks the most efficient path || Source: Codex Leicester"
                    ],
                    anatomy: [
                        "Incorporate Vitruvian proportions for optimal ergonomics || Proportional harmony based on the Vitruvian system || Source: Venice Accademia",
                        "Apply layered system integration mimicking biological structures || Layered system integration || Source: Anatomical drawings"
                    ],
                    optics: [
                        "Integrate sfumato gradients for perceptual depth || Sfumato: do not make definite boundaries || Source: Ash.II, 14v",
                        "Apply golden ratio for aesthetic harmony || Golden ratio in natural designs || Source: Divine Proportion"
                    ]
                }
            };
        }

        document.getElementById('generateBtn').addEventListener('click', generateDesign);
        initializeUI();
    </script>
</body>
</html>

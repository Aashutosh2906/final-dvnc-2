<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVNC.AI - Da Vinci Innovation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a1a1a;
            --primary-dark: #000000;
            --secondary: #2a2a2a;
            --tertiary: #666666;
            --quaternary: #999999;
            --background: #FFFFFF;
            --surface: #FAFAFA;
            --border: #E0E0E0;
            --accent: #D4AF37;
            --accent-dark: #B8960F;
            --accent-light: rgba(212, 175, 55, 0.15);
            --accent-lighter: rgba(212, 175, 55, 0.08);
            --success: #27AE60;
            --warning: #F39C12;
            --error: #E74C3C;
            --mechanics: #3498DB;
            --anatomy: #27AE60;
            --optics: #F39C12;
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.12);
            --transition: cubic-bezier(0.4, 0, 0.2, 1);
            --text-primary: #000000;
            --text-secondary: #2a2a2a;
            --text-tertiary: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px;
            line-height: 1.5;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .logo-mark {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo-text {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            margin-top: 56px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .sidebar-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .prompt-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .prompt-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s var(--transition);
            font-size: 13px;
            color: var(--secondary);
            position: relative;
            overflow: hidden;
        }

        .prompt-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-lighter);
            opacity: 0;
            transition: opacity 0.2s var(--transition);
        }

        .prompt-item:hover::before {
            opacity: 1;
        }

        .prompt-item.selected {
            background: var(--accent-light);
            color: var(--accent);
            font-weight: 500;
        }

        .generate-section {
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .generate-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .generate-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #9B7B00, var(--accent-dark));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn-icon {
            transition: transform 0.2s var(--transition);
        }

        .generate-btn:hover:not(:disabled) .generate-btn-icon {
            transform: translateX(2px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 56px;
            background: var(--background);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* Welcome State with new pulsating design */
        .welcome-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 112px);
            animation: fadeIn 0.6s var(--transition);
            overflow: hidden;
            position: relative;
        }

        /* Constellation background canvas */
        .constellation-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
            height: 100%;
            z-index: 1;
        }

        .tagline {
            color: #999;
            font-size: 0.9em;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 30px;
            text-align: center;
            opacity: 0;
            animation: fadeInDown 1s ease forwards;
        }

        @keyframes fadeInDown {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        .logo-section {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Main pulsating circle with planet effect */
        .main-circle {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #B8960F, #D4AF37);
            border-radius: 50%;
            margin-bottom: 25px;
            opacity: 0;
            animation: scaleIn 0.8s ease forwards 0.3s, heartbeat 2s ease-in-out infinite 0.8s;
            position: relative;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4),
                        inset -5px -5px 10px rgba(184, 150, 15, 0.3),
                        inset 5px 5px 10px rgba(255, 255, 255, 0.2);
        }

        /* Planet glow effect */
        .main-circle::after {
            content: '';
            position: absolute;
            top: -20%;
            left: -20%;
            width: 140%;
            height: 140%;
            border-radius: 50%;
            background: radial-gradient(circle at center, 
                        rgba(212, 175, 55, 0.2) 0%, 
                        rgba(212, 175, 55, 0.1) 40%, 
                        transparent 70%);
            animation: planetGlow 3s ease-in-out infinite;
        }

        @keyframes planetGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        /* Heartbeat animation from second code */
        @keyframes heartbeat {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            14% {
                transform: scale(1.05);
                opacity: 0.9;
            }
            28% {
                transform: scale(1);
                opacity: 1;
            }
            42% {
                transform: scale(1.08);
                opacity: 0.85;
            }
            70% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
            from {
                opacity: 0;
                transform: scale(0.5);
            }
        }

        .brand-name {
            font-size: 3.2em;
            letter-spacing: 14px;
            font-weight: 100;
            margin-bottom: 15px;
            opacity: 0;
            animation: fadeInUp 1s ease forwards 0.5s;
            color: var(--primary);
            position: relative;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', 'Helvetica Neue', sans-serif;
        }

        .brand-name::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            animation: expandLine 0.8s ease forwards 1.3s;
        }

        @keyframes expandLine {
            to {
                opacity: 1;
                width: 120px;
            }
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        /* Features wrapper with constellation container */
        .features-wrapper {
            position: relative;
            width: 400px;
            height: 140px;
            margin-bottom: 15px;
        }

        /* SVG constellation connections */
        .constellation-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .constellation-line {
            stroke: rgba(212, 175, 55, 0.2);
            stroke-width: 0.5;
            fill: none;
            stroke-linecap: round;
            animation: constellationPulse 4s ease-in-out infinite;
        }

        @keyframes constellationPulse {
            0%, 100% { opacity: 0.2; stroke-width: 0.5; }
            50% { opacity: 0.4; stroke-width: 0.7; }
        }

        .features-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .feature-row {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            z-index: 10;
            position: relative;
        }

        .feature-row-secondary {
            display: flex;
            gap: 50px;
            margin-top: 20px;
            margin-bottom: 30px;
            justify-content: center;
            position: relative;
        }

        /* Secondary constellation SVG */
        .constellation-svg-secondary {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120%;
            height: 140%;
            z-index: 0;
            pointer-events: none;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            animation: fadeInScale 0.8s ease forwards;
            z-index: 2;
        }

        .feature-item:nth-child(1) { animation-delay: 0.6s; }
        .feature-item:nth-child(2) { animation-delay: 0.7s; }
        .feature-item:nth-child(3) { animation-delay: 0.8s; }

        @keyframes fadeInScale {
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            from {
                opacity: 0;
                transform: scale(0.9) translateY(10px);
            }
        }

        /* Planet-style feature circles */
        .feature-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
            background: radial-gradient(circle at 30% 30%, 
                        rgba(212, 175, 55, 0.3), 
                        rgba(212, 175, 55, 0.1));
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2),
                        inset -2px -2px 5px rgba(184, 150, 15, 0.2);
        }

        /* Orbital ring for planets */
        .feature-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            border: 0.5px solid rgba(212, 175, 55, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%) rotateX(60deg);
            animation: orbit 10s linear infinite;
        }

        @keyframes orbit {
            0% { transform: translate(-50%, -50%) rotateX(60deg) rotateZ(0deg); }
            100% { transform: translate(-50%, -50%) rotateX(60deg) rotateZ(360deg); }
        }

        .feature-circle:hover {
            transform: scale(1.15);
            border-color: var(--accent-dark);
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.4),
                        inset -3px -3px 8px rgba(184, 150, 15, 0.3);
        }

        .half-fill {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, 
                        rgba(212, 175, 55, 0.5), 
                        rgba(184, 150, 15, 0.3));
            transition: height 0.3s ease;
            opacity: 0.7;
            border-radius: 50% 50% 0 0;
        }

        .feature-circle:hover .half-fill {
            height: 70%;
            opacity: 0.9;
        }

        .feature-circle-secondary {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--accent);
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            background: radial-gradient(circle at 70% 30%, 
                        rgba(212, 175, 55, 0.25), 
                        rgba(212, 175, 55, 0.08));
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.15),
                        inset -3px -3px 6px rgba(184, 150, 15, 0.15);
        }

        .feature-circle-secondary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 160%;
            height: 160%;
            border: 0.5px solid rgba(212, 175, 55, 0.08);
            border-radius: 50%;
            transform: translate(-50%, -50%) rotateX(45deg);
            animation: orbit 12s linear infinite reverse;
        }

        .feature-circle-secondary:hover {
            transform: scale(1.12);
            border-color: var(--accent-dark);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3),
                        inset -4px -4px 10px rgba(184, 150, 15, 0.25);
        }

        .feature-circle-secondary .half-fill {
            background: linear-gradient(180deg, 
                        transparent, 
                        rgba(212, 175, 55, 0.4));
            bottom: 0;
            top: auto;
            opacity: 0.7;
            border-radius: 0 0 50% 50%;
        }

        .feature-text {
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #666;
            text-align: center;
        }

        /* Connecting lines container */
        .connection-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-line {
            stroke: rgba(212, 175, 55, 0.15);
            stroke-width: 0.8;
            fill: none;
            stroke-linecap: round;
            opacity: 0;
            animation: fadeInLine 1.5s ease-out forwards;
        }

        @keyframes fadeInLine {
            to {
                opacity: 1;
            }
        }

        .connection-line.primary {
            stroke: rgba(212, 175, 55, 0.2);
            stroke-width: 1;
            animation-delay: 0.8s;
        }

        .connection-line.secondary {
            stroke: rgba(212, 175, 55, 0.1);
            stroke-width: 0.6;
            animation-delay: 1s;
        }

        .connection-line.cross {
            stroke: rgba(212, 175, 55, 0.08);
            stroke-width: 0.5;
            stroke-dasharray: 2 4;
            animation-delay: 1.2s;
        }

        /* Stardust effect */
        .stardust {
            position: absolute;
            width: 1px;
            height: 1px;
            background: rgba(212, 175, 55, 0.8);
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .input-container {
            width: 100%;
            max-width: 500px;
            position: relative;
            opacity: 0;
            animation: slideUp 1s ease forwards 1.2s;
            margin-top: 20px;
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(30px);
            }
        }

        .ai-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 30px;
            font-size: 0.95em;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .ai-input:focus {
            border-color: #333;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.05);
        }

        .ai-input::placeholder {
            color: #aaa;
        }

        .send-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: black;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            background: #333;
            transform: translateY(-50%) scale(1.1);
        }

        .send-button:active {
            transform: translateY(-50%) scale(0.95);
        }

        .arrow {
            font-size: 18px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .features-container {
                flex-direction: column;
                gap: 20px;
            }

            .feature-row {
                flex-direction: column;
                gap: 30px;
            }

            .feature-row-secondary {
                flex-direction: column;
                gap: 30px;
            }

            .brand-name {
                font-size: 2.5em;
                letter-spacing: 10px;
            }

            .brand-name::before {
                width: 50px;
            }

            @keyframes expandLine {
                to {
                    opacity: 1;
                    width: 80px;
                }
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <img src="https://static.wixstatic.com/media/33c4b5_158b573e4df145c7856f1330dbd9e49d~mv2.jpg" alt="DVNC.AI" style="height: 36px; width: auto; border-radius: 8px;">
            </div>
            <!-- New Chat Button -->
            <button class="new-chat-btn" id="newChatBtn" onclick="startNewChat()">
                <span>↻</span>
                <span>New Chat</span>
            </button>
            <div class="partner-logo" style="display: flex; align-items: center; gap: 10px;">
                <img src="https://static.wixstatic.com/media/33c4b5_79ea16e09e1b471dae81c5dffb012bb4~mv2.jpeg" alt="TAAMCrypto" style="height: 40px; width: 40px; border-radius: 50%; object-fit: cover;">
                <span style="font-size: 14px; font-weight: 600; color: var(--text-secondary);">TAAMCrypto</span>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Design Prompts</div>
                <div class="sidebar-subtitle">Select a prompt to begin synthesis</div>
            </div>
            
            <div class="prompt-list" id="promptList"></div>

            <div class="generate-section">
                <button class="generate-btn" id="generateBtn" disabled>
                    <span>Generate Design</span>
                    <span class="generate-btn-icon">→</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="chat-container" id="chatContainer">
                <div class="welcome-state" id="welcomeState">
                    <!-- Constellation background canvas -->
                    <canvas class="constellation-canvas" id="constellationCanvas"></canvas>
                    
                    <div class="hero-container">
                        <div class="tagline">Leonardo's Intelligence Reimagined for the 21st Century</div>
                        
                        <!-- SVG for all connection lines -->
                        <svg class="connection-lines" id="connectionLines">
                            <!-- Lines will be dynamically generated -->
                        </svg>
                        
                        <div class="logo-section">
                            <div class="main-circle" id="mainPlanet"></div>
                            <div class="brand-name">DVNC</div>
                        </div>
                        
                        <!-- Features with constellation connections -->
                        <div class="features-wrapper">
                            <div class="features-container" id="featuresContainer">
                                <div class="feature-row">
                                    <div class="feature-item">
                                        <div class="feature-circle" data-planet="1" id="planet1">
                                            <div class="half-fill"></div>
                                        </div>
                                        <div class="feature-text">Business<br>Strategy</div>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-circle" data-planet="2" id="planet2">
                                            <div class="half-fill"></div>
                                        </div>
                                        <div class="feature-text">Curation</div>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-circle" data-planet="3" id="planet3">
                                            <div class="half-fill"></div>
                                        </div>
                                        <div class="feature-text">Policy<br>Ideation</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feature-row-secondary">
                            <div class="feature-item" style="animation-delay: 0.9s;">
                                <div class="feature-circle-secondary" data-planet="4" id="planet4">
                                    <div class="half-fill"></div>
                                </div>
                                <div class="feature-text">Product<br>Design</div>
                            </div>
                            <div class="feature-item" style="animation-delay: 1s;">
                                <div class="feature-circle-secondary" data-planet="5" id="planet5">
                                    <div class="half-fill"></div>
                                </div>
                                <div class="feature-text">Learning<br>Design</div>
                            </div>
                            <div class="feature-item" style="animation-delay: 1.1s;">
                                <div class="feature-circle-secondary" data-planet="6" id="planet6">
                                    <div class="half-fill"></div>
                                </div>
                                <div class="feature-text">Career<br>Design</div>
                            </div>
                            <div class="feature-item" style="animation-delay: 1.2s;">
                                <div class="feature-circle-secondary" data-planet="7" id="planet7">
                                    <div class="half-fill"></div>
                                </div>
                                <div class="feature-text">Research<br>Design</div>
                            </div>
                        </div>
                        
                        <div class="input-container">
                            <input type="text" class="ai-input" placeholder="Ask DVNC.AI anything">
                            <button class="send-button">
                                <span class="arrow">➤</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/generate';
        
        const prompts = [
            "a next-generation ergonomic computer mouse",
            "an innovative kitchen kettle for urban living",
            "a modular laptop docking station",
            "a patient monitoring device for hospitals",
            "a precision gardening tool system",
            "a sustainable packaging solution for electronics",
            "a smart home lighting system",
            "an eco-friendly water bottle",
            "a wearable fitness tracker",
            "a compact urban bicycle"
        ];

        let selectedPrompt = '';
        let isGenerating = false;

        function initializeUI() {
            const promptList = document.getElementById('promptList');
            
            prompts.forEach((prompt, index) => {
                const promptItem = document.createElement('div');
                promptItem.className = 'prompt-item';
                promptItem.dataset.prompt = prompt;
                promptItem.textContent = prompt;
                promptItem.onclick = () => selectPrompt(prompt, promptItem);
                promptList.appendChild(promptItem);
            });

            // Initialize constellation animations
            initializeConnectionLines();
            initializeStardust();
            initializeBackgroundCanvas();
        }

        function selectPrompt(prompt, element) {
            if (isGenerating) return;
            
            document.querySelectorAll('.prompt-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedPrompt = prompt;
            document.getElementById('generateBtn').disabled = false;
        }

        function createMessageThread(userPrompt) {
            return `
                <div class="message-thread">
                    <div class="message-user">
                        <div class="message-user-content">
                            Design ${userPrompt}
                        </div>
                    </div>
                    <div class="message-ai" id="aiMessage">
                        <!-- AI response will be populated here -->
                    </div>
                </div>
            `;
        }

        function formatSLMOutputs(type, icon, outputs) {
            let outputsHtml = outputs.map((output, idx) => {
                let description = output;
                let inspiration = '';
                let source = '';
                
                if (output.includes('||')) {
                    const parts = output.split('||').map(p => p.trim());
                    description = parts[0];
                    if (parts[1]) inspiration = parts[1];
                    if (parts[2]) source = parts[2].replace('Source:', '').trim();
                }
                
                return `
                    <div class="output-item ${type}" style="animation-delay: ${idx * 0.1}s">
                        <div class="output-description">• ${description}</div>
                        ${inspiration ? `
                            <div class="output-inspiration">
                                "${inspiration}"
                                ${source ? `<div class="output-source">— ${source}</div>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            return outputsHtml;
        }

        function formatFeatures(features) {
            return features.map((feature, idx) => `
                <div class="feature-card" style="animation-delay: ${idx * 0.1}s">
                    <div class="feature-number">${idx + 1}</div>
                    <div class="feature-description">${feature.description}</div>
                    <div class="feature-inspiration">
                        "${feature.inspiration}"
                    </div>
                    <div class="feature-metadata">
                        <div class="development-stage stage-${feature.stage.toLowerCase().replace('_', '-')}">
                            ${feature.stage.replace('_', ' ')}
                        </div>
                        <div class="engineering-notes">${feature.notes}</div>
                    </div>
                </div>
            `).join('');
        }

        function formatProduct(data) {
            const featuresList = data.features.map(feat => {
                const inspirationOnly = feat.inspiration.split('||')[0].trim();
                return `
                    <li class="highlight-item">
                        <div class="highlight-text">
                            <span class="highlight-feature">${feat.description}</span> - 
                            Inspired by "${inspirationOnly}", this feature is currently at 
                            ${feat.stage.toLowerCase().replace('_', ' ')} stage. ${feat.notes}.
                        </div>
                    </li>
                `;
            }).join('');

            return `
                <div class="product-section">
                    <div class="product-header">
                        <div class="product-name">${data.name}</div>
                        <div class="product-market">Target Market: ${data.target_market}</div>
                    </div>
                    
                    <div class="scores-container">
                        <div class="score-item">
                            <div class="score-label">Innovation Score</div>
                            <div class="score-value">${data.innovation_score}/10</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.innovation_score * 10}%"></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Feasibility Score</div>
                            <div class="score-value">${data.feasibility_score}/10</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.feasibility_score * 10}%"></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Market Viability</div>
                            <div class="score-value">${(data.viability_score * 100).toFixed(0)}%</div>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${data.viability_score * 100}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="product-description">
                        <h3>Final Product Design</h3>
                        
                        <div class="product-highlights">
                            <h4>${data.name} - Revolutionary ${data.product_type}</h4>
                            <ul class="highlight-list">
                                ${featuresList}
                            </ul>
                        </div>
                        
                        <div class="product-summary">
                            <p class="summary-text">
                                The ${data.name} represents a paradigm shift in ${data.product_type} design, 
                                seamlessly integrating mechanical precision, biological inspiration, and aesthetic elegance. 
                                With an innovation score of ${data.innovation_score}/10 and feasibility rating of 
                                ${data.feasibility_score}/10, this design achieves a remarkable ${(data.viability_score * 100).toFixed(0)}% 
                                market viability, embodying the Renaissance ideal of perfect harmony between form and function.
                            </p>
                        </div>
                    </div>
                    
                    <div class="principles-list">
                        <div class="principle-tag">⚙ Mechanics & Physics</div>
                        <div class="principle-tag">🦋 Anatomy & Biology</div>
                        <div class="principle-tag">👁 Optics & Aesthetics</div>
                    </div>
                </div>
            `;
        }

        function startNewChat() {
            window.location.reload();
        }

        async function generateDesign() {
            if (!selectedPrompt || isGenerating) return;
            
            isGenerating = true;
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            
            const chatContainer = document.getElementById('chatContainer');
            const welcomeState = document.getElementById('welcomeState');
            if (welcomeState) welcomeState.remove();
            
            document.getElementById('newChatBtn').classList.add('visible');
            
            chatContainer.innerHTML = createMessageThread(selectedPrompt);
            const aiMessage = document.getElementById('aiMessage');
            
            let responseHTML = `
                <div class="ai-section" style="animation-delay: 0s">
                    <div class="step-title">
                        Initializing Da Vinci Knowledge Synthesis
                        <span class="step-status" id="initStatus">Processing</span>
                    </div>
                </div>
                
                <div class="process-step" id="mechanicsStep">
                    <div class="step-indicator mechanics" id="mechanicsIndicator">⚙</div>
                    <div class="step-content">
                        <div class="step-title">
                            Mechanics & Physics SLM
                            <span class="step-status" id="mechanicsStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="mechanicsOutputs"></div>
                    </div>
                </div>
                
                <div class="process-step" id="anatomyStep">
                    <div class="step-indicator anatomy" id="anatomyIndicator">🦋</div>
                    <div class="step-content">
                        <div class="step-title">
                            Anatomy & Biology SLM
                            <span class="step-status" id="anatomyStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="anatomyOutputs"></div>
                    </div>
                </div>
                
                <div class="process-step" id="opticsStep">
                    <div class="step-indicator optics" id="opticsIndicator">👁</div>
                    <div class="step-content">
                        <div class="step-title">
                            Optics & Aesthetics SLM
                            <span class="step-status" id="opticsStatus" style="display: none">Processing</span>
                        </div>
                        <div class="step-outputs" id="opticsOutputs"></div>
                    </div>
                </div>
                
                <div id="synthesisSection"></div>
                <div id="featuresSection"></div>
                <div id="productSection"></div>
            `;
            
            aiMessage.innerHTML = responseHTML;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                document.getElementById('initStatus').textContent = 'Complete';
                document.getElementById('initStatus').classList.add('complete');
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: selectedPrompt })
                }).catch(() => null);
                
                const data = response && response.ok ? await response.json() : getMockData();
                
                await processSLM('mechanics', '⚙', data.slm_outputs.mechanics);
                await processSLM('anatomy', '🦋', data.slm_outputs.anatomy);
                await processSLM('optics', '👁', data.slm_outputs.optics);
                
                await new Promise(resolve => setTimeout(resolve, 500));
                document.getElementById('synthesisSection').innerHTML = `
                    <div class="synthesis-container" id="synthesisContainer">
                        <div class="synthesis-header">
                            <div class="synthesis-title">Da Vinci Abstraction Organ</div>
                            <div class="synthesis-subtitle">Synthesizing knowledge domains...</div>
                        </div>
                        <div class="synthesis-visual" id="synthesisVisual">
                            <div class="knowledge-node mechanics" id="nodeMechanics">
                                <div class="node-icon">⚙</div>
                                <div class="node-label">Mechanics</div>
                            </div>
                            <div class="knowledge-node anatomy" id="nodeAnatomy">
                                <div class="node-icon">🦋</div>
                                <div class="node-label">Anatomy</div>
                            </div>
                            <div class="knowledge-node optics" id="nodeOptics">
                                <div class="node-icon">👁</div>
                                <div class="node-label">Optics</div>
                            </div>
                            <div class="synthesis-center" id="synthesisCenter">◈</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('synthesisContainer').scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const nodeMechanics = document.getElementById('nodeMechanics');
                const nodeAnatomy = document.getElementById('nodeAnatomy');
                const nodeOptics = document.getElementById('nodeOptics');
                const synthesisCenter = document.getElementById('synthesisCenter');
                
                nodeMechanics.style.transition = 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
                nodeAnatomy.style.transition = 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
                nodeOptics.style.transition = 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
                
                await new Promise(resolve => setTimeout(resolve, 200));
                nodeMechanics.style.transform = 'translateX(60px) scale(0.95)';
                nodeAnatomy.style.transform = 'translateX(0px) scale(0.95)';
                nodeOptics.style.transform = 'translateX(-60px) scale(0.95)';
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                synthesisCenter.style.animation = 'centerExpand 1s cubic-bezier(0.4, 0, 0.2, 1) forwards, pulse 0.6s ease-out 1s 3';
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const synthesisVisual = document.getElementById('synthesisVisual');
                synthesisVisual.style.transition = 'transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.8s ease-out';
                synthesisVisual.style.transform = 'scale(0.8) translateY(-20px)';
                synthesisVisual.style.opacity = '0.7';
                
                document.getElementById('featuresSection').innerHTML = `
                    <div class="features-section" id="featuresDiv" style="opacity: 0; transform: translateY(30px);">
                        <div class="features-header">Synthesized Design Features</div>
                        <div class="features-grid">
                            ${formatFeatures(data.features)}
                        </div>
                    </div>
                `;
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const featuresDiv = document.getElementById('featuresDiv');
                featuresDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                featuresDiv.style.transition = 'opacity 1s ease-out, transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
                await new Promise(resolve => setTimeout(resolve, 100));
                featuresDiv.style.opacity = '1';
                featuresDiv.style.transform = 'translateY(0)';
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                document.getElementById('productSection').innerHTML = formatProduct(data);
                document.getElementById('productSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (error) {
                console.error('Error:', error);
            } finally {
                isGenerating = false;
                generateBtn.disabled = false;
            }
        }

        async function processSLM(type, icon, outputs) {
            const indicator = document.getElementById(`${type}Indicator`);
            const status = document.getElementById(`${type}Status`);
            const outputsContainer = document.getElementById(`${type}Outputs`);
            
            indicator.classList.add('active');
            status.style.display = 'inline-block';
            
            const step = document.getElementById(`${type}Step`);
            if (step) {
                step.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            outputsContainer.innerHTML = formatSLMOutputs(type, icon, outputs);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            indicator.classList.remove('active');
            indicator.classList.add('complete');
            status.textContent = 'Complete';
            status.classList.add('complete');
        }

        function getMockData() {
            return {
                name: `Vitruvian ${['Harmony', 'Flow', 'Aero', 'Sfumato'][Math.floor(Math.random() * 4)]} ${selectedPrompt.split(' ').slice(-1)[0]}`,
                product_type: selectedPrompt,
                target_market: ['Consumer Electronics', 'Industrial Equipment', 'Medical Devices', 'Sustainable Goods'][Math.floor(Math.random() * 4)],
                innovation_score: Math.floor(Math.random() * 3) + 7,
                feasibility_score: Math.floor(Math.random() * 3) + 7,
                viability_score: (Math.random() * 0.3 + 0.7).toFixed(2),
                features: [
                    {
                        description: "Apply pyramidal law of force to enhance mechanical efficiency and durability",
                        inspiration: "Pyramidal law of force: power diminishes towards its end",
                        stage: "PROTOTYPE",
                        notes: "Prototype feasible with current technology"
                    },
                    {
                        description: "Incorporate proportional harmony based on the Vitruvian system for ergonomic design",
                        inspiration: "Proportional harmony based on the Vitruvian system",
                        stage: "PRODUCTION_READY",
                        notes: "Production-ready using established processes"
                    },
                    {
                        description: "Integrate sfumato technique for visual harmony and perceptual depth",
                        inspiration: "Sfumato: do not make definite boundaries",
                        stage: "CONCEPT",
                        notes: "Conceptual exploration requires validation"
                    }
                ],
                slm_outputs: {
                    mechanics: [
                        "Apply pyramidal law of force to enhance mechanical efficiency || Pyramidal law of force: power diminishes towards its end || Source: Madrid I, 16r",
                        "Use water flow principles for efficient energy distribution || Water seeks the most efficient path || Source: Codex Leicester"
                    ],
                    anatomy: [
                        "Incorporate Vitruvian proportions for optimal ergonomics || Proportional harmony based on the Vitruvian system || Source: Venice Accademia",
                        "Apply layered system integration mimicking biological structures || Layered system integration || Source: Anatomical drawings"
                    ],
                    optics: [
                        "Integrate sfumato gradients for perceptual depth || Sfumato: do not make definite boundaries || Source: Ash.II, 14v",
                        "Apply golden ratio for aesthetic harmony || Golden ratio in natural designs || Source: Divine Proportion"
                    ]
                }
            };
        }

        document.getElementById('generateBtn').addEventListener('click', generateDesign);

        // Initialize connection lines between all circles
        function initializeConnectionLines() {
            const svg = document.getElementById('connectionLines');
            
            setTimeout(() => {
                const mainPlanet = document.getElementById('mainPlanet');
                const planets = [];
                
                for (let i = 1; i <= 7; i++) {
                    const planet = document.getElementById(`planet${i}`);
                    if (planet) {
                        const rect = planet.getBoundingClientRect();
                        const containerRect = svg.getBoundingClientRect();
                        planets.push({
                            id: i,
                            x: rect.left - containerRect.left + rect.width / 2,
                            y: rect.top - containerRect.top + rect.height / 2
                        });
                    }
                }
                
                const mainRect = mainPlanet.getBoundingClientRect();
                const containerRect = svg.getBoundingClientRect();
                const mainPos = {
                    x: mainRect.left - containerRect.left + mainRect.width / 2,
                    y: mainRect.top - containerRect.top + mainRect.height / 2
                };
                
                for (let i = 0; i < 3; i++) {
                    if (planets[i]) {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', mainPos.x);
                        line.setAttribute('y1', mainPos.y);
                        line.setAttribute('x2', planets[i].x);
                        line.setAttribute('y2', planets[i].y);
                        line.setAttribute('class', 'connection-line primary');
                        line.style.animationDelay = `${0.8 + i * 0.1}s`;
                        svg.appendChild(line);
                    }
                }
                
                for (let i = 3; i < 7; i++) {
                    if (planets[i]) {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', mainPos.x);
                        line.setAttribute('y1', mainPos.y);
                        line.setAttribute('x2', planets[i].x);
                        line.setAttribute('y2', planets[i].y);
                        line.setAttribute('class', 'connection-line secondary');
                        line.style.animationDelay = `${1.1 + (i - 3) * 0.1}s`;
                        svg.appendChild(line);
                    }
                }
                
                if (planets[0] && planets[1]) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', planets[0].x);
                    line.setAttribute('y1', planets[0].y);
                    line.setAttribute('x2', planets[1].x);
                    line.setAttribute('y2', planets[1].y);
                    line.setAttribute('class', 'connection-line secondary');
                    line.style.animationDelay = '1.3s';
                    svg.appendChild(line);
                }
                
                if (planets[1] && planets[2]) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', planets[1].x);
                    line.setAttribute('y1', planets[1].y);
                    line.setAttribute('x2', planets[2].x);
                    line.setAttribute('y2', planets[2].y);
                    line.setAttribute('class', 'connection-line secondary');
                    line.style.animationDelay = '1.4s';
                    svg.appendChild(line);
                }
                
                for (let i = 3; i < 6; i++) {
                    if (planets[i] && planets[i + 1]) {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', planets[i].x);
                        line.setAttribute('y1', planets[i].y);
                        line.setAttribute('x2', planets[i + 1].x);
                        line.setAttribute('y2', planets[i + 1].y);
                        line.setAttribute('class', 'connection-line secondary');
                        line.style.animationDelay = `${1.5 + (i - 3) * 0.1}s`;
                        svg.appendChild(line);
                    }
                }
                
                if (planets[0] && planets[4]) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', planets[0].x);
                    line.setAttribute('y1', planets[0].y);
                    line.setAttribute('x2', planets[4].x);
                    line.setAttribute('y2', planets[4].y);
                    line.setAttribute('class', 'connection-line cross');
                    line.style.animationDelay = '1.8s';
                    svg.appendChild(line);
                }
                
                if (planets[2] && planets[6]) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', planets[2].x);
                    line.setAttribute('y1', planets[2].y);
                    line.setAttribute('x2', planets[6].x);
                    line.setAttribute('y2', planets[6].y);
                    line.setAttribute('class', 'connection-line cross');
                    line.style.animationDelay = '1.9s';
                    svg.appendChild(line);
                }
            }, 1000);
        }

        // Create stardust effect
        function initializeStardust() {
            const heroContainer = document.querySelector('.hero-container');
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'stardust';
                
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                star.style.animationDuration = `${3 + Math.random() * 2}s`;
                
                heroContainer.appendChild(star);
            }
        }

        // Background canvas for subtle star field
        function initializeBackgroundCanvas() {
            const canvas = document.getElementById('constellationCanvas');
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            const stars = [];
            const numStars = 50;
            
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 0.8 + 0.2,
                    opacity: Math.random() * 0.5 + 0.1,
                    twinkleSpeed: Math.random() * 0.02 + 0.005
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                stars.forEach(star => {
                    star.opacity += star.twinkleSpeed;
                    if (star.opacity > 0.6 || star.opacity < 0.1) {
                        star.twinkleSpeed = -star.twinkleSpeed;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(212, 175, 55, ${star.opacity})`;
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>.height = canvas.offsetHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            const stars = [];
            const numStars = 50;
            
            // Create stars
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 0.8 + 0.2,
                    opacity: Math.random() * 0.5 + 0.1,
                    twinkleSpeed: Math.random() * 0.02 + 0.005
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                stars.forEach(star => {
                    star.opacity += star.twinkleSpeed;
                    if (star.opacity > 0.6 || star.opacity < 0.1) {
                        star.twinkleSpeed = -star.twinkleSpeed;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(212, 175, 55, ${star.opacity})`;
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
</body>
</html>
